# Bunnyshell Environment Configuration
# This file defines the components and services for deploying the Argo Workflow Manager
# For more information, see: https://documentation.bunnyshell.com/

kind: Environment
name: argo-workflow-manager
type: primary

components:
  # PostgreSQL Database
  - name: postgres
    kind: Database
    dockerCompose:
      image: postgres:15-alpine
      environment:
        POSTGRES_PASSWORD: password
        POSTGRES_DB: postgres
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"

  # Backend API Service
  - name: backend
    kind: Application
    gitRepo: "https://github.com/iminsik/argo-workflow.git"
    gitBranch: "main"
    gitApplicationPath: "."
    dockerCompose:
      build:
        context: .
        dockerfile: ./apps/backend/Dockerfile
    environment:
      DATABASE_URL: postgresql://postgres:password@postgres:5432/postgres
      ARGO_NAMESPACE: argo
      WORKFLOW_MANIFEST_PATH: /infrastructure/argo/python-processor.yaml
      CORS_ORIGINS: "*"  # Configure based on your frontend URL in production
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    pod:
      serviceAccountName: backend-sa

  # Frontend Application
  - name: frontend
    kind: Application
    gitRepo: "https://github.com/iminsik/argo-workflow.git"
    gitBranch: "main"
    gitApplicationPath: "."
    dockerCompose:
      build:
        context: .
        dockerfile: ./apps/frontend/Dockerfile
        args:
          VITE_API_URL: http://backend:8000
    environment:
      VITE_API_URL: http://backend:8000
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"

